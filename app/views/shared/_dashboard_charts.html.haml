%h2.text-2xl.font-semibold.mb-4.mt-4 Run Stats
= form_with url: form_url, method: :get, class: "mb-6", local: true do |f|
  = f.select :range, options_for_select([["Last 7 days", "7"], ["Last 14 days", "14"], ["Last 30 days", "30"], ["Last 90 days", "90"]], params[:range] || "7"), {}, class: "rounded-lg py-2 px-3 border border-gray-300"
  = f.submit "Apply", class: "ml-2 px-4 py-2 border border-blue-600 text-blue-600 font-semibold rounded-lg hover:bg-blue-50"

.stats.stats-vertical.lg:stats-horizontal.shadow
  .stat
    .stat-figure.text-primary
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-activity-icon lucide-activity mt-10"><path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"/></svg>
    .stat-title.mb-4 Total Runs
    .stat-value= dashboard_stats[:total_runs]

  .stat
    .stat-figure.text-primary
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-thumbs-up-icon lucide-thumbs-up mt-10"><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z"/></svg>
    .stat-title.mb-4 Successful Runs
    .stat-value= dashboard_stats[:successful]

  .stat
    .stat-figure.text-primary
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-hourglass-icon lucide-hourglass mt-10"><path d="M5 22h14"/><path d="M5 2h14"/><path d="M17 22v-4.172a2 2 0 0 0-.586-1.414L12 12l-4.414 4.414A2 2 0 0 0 7 17.828V22"/><path d="M7 2v4.172a2 2 0 0 0 .586 1.414L12 12l4.414-4.414A2 2 0 0 0 17 6.172V2"/></svg>
    .stat-title.mb-4 Pending Runs
    .stat-value= dashboard_stats[:pending]

  .stat
    .stat-figure.text-primary
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-thumbs-down-icon lucide-thumbs-down mt-10"><path d="M17 14V2"/><path d="M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z"/></svg>
    .stat-title.mb-4 Failed Runs
    .stat-value.text-secondary= dashboard_stats[:failed]
  

%h2.text-xl.font-semibold.mt-10.mb-4 Total Runs Per Day
= column_chart total_runs_per_day, xtitle: "Date", ytitle: "Runs", library: { backgroundColor: "transparent" }


%h2.text-xl.font-medium.mb-4 Successful Runs
= column_chart @successful_runs_per_day, colors: ["#10B981"], xtitle: "Date", ytitle: "Runs", library: { backgroundColor: "transparent" }

%h2.text-xl.font-medium.mb-4 Pending Runs
= column_chart @pending_runs_per_day, colors: ["#F59E0B"], xtitle: "Date", ytitle: "Runs", library: { backgroundColor: "transparent" }

%h2.text-xl.font-medium.mb-4 Failed Runs
= column_chart @failed_runs_per_day, colors: ["#EF4444"], xtitle: "Date", ytitle: "Runs", library: { backgroundColor: "transparent" }

%h2.text-xl.font-semibold.mt-10.mb-4 Success Rate
= area_chart success_rate_data, suffix: "%", xtitle: "Date", ytitle: "Success Rate", points: false

- unless controller.controller_name == "flows"
  - if @flows_with_stats.any?
    %h2.text-2xl.font-semibold.mb-4 Flows
    %table.min-w-full.bg-white.border.rounded-lg.shadow.overflow-hidden.text-sm.mb-10.mt-4
      %thead.bg-gray-100.text-gray-600
      %tr
        %th.text-left.px-4.py-3 Name
        %th.text-left.px-4.py-3 Total
        %th.text-left.px-4.py-3 Success
        %th.text-left.px-4.py-3 Failed
        %th.text-left.px-4.py-3 ⏱ Avg Duration
        %th.text-left.px-4.py-3 ⏱ Max Duration
      %tbody.divide-y
        - @flows_with_stats.each do |stat|
          - flow = stat[:flow]
          %tr.hover:bg-gray-50
            %td.px-4.py-3.font-medium= link_to flow.name, flow_path(flow), class: "text-blue-600 hover:underline"
            %td.px-4.py-3= stat[:total_runs]
            %td.px-4.py-3.text-green-600= stat[:successful_runs]
            %td.px-4.py-3.text-red-600= stat[:failed_runs]
            %td.px-4.py-3= stat[:mean_duration] ? "#{stat[:mean_duration]}s" : "—"
            %td.px-4.py-3= stat[:max_duration] ? "#{stat[:max_duration].round(2)}s" : "—"